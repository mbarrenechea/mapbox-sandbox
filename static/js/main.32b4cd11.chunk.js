(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(t,e,a){t.exports=a(129)},108:function(t,e,a){},109:function(t,e,a){},111:function(t,e){},112:function(t,e){},113:function(t,e){},129:function(t,e,a){"use strict";a.r(e);var n=a(13),o=a.n(n),i=a(79),r=a.n(i),l=(a(108),a(1)),s=a(2),c=a(7),u=a(5),d=a(8),h=(a(109),a(110),a(61)),p=a(85),m=a(135),f=a(86),g=a(60),v=a(0),y=a(49),b=a.n(y),_=a(15),T=a(11),x=a(136),w=T.r.fp64LowPart,C=function(t){function e(){return Object(l.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(s.a)(e,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n \n  vTexCoord = texCoords;\n \n  picking_setPickingColor(vec3(0., 0., 1.));\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\nuniform float startDate;\nuniform float endDate;\nuniform float zoom;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor / 255.0;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor / 255.0, vec4(color, 1.0), alpha);\n}\n\n// decode loss layer\nvec4 decodeFunction(vec3 color, float year) {\n  float intensity = color.r * 255.;\n  // float exponent = zoom > 11. ? 0.3 + (zoom - 3.) / 20. : 1.;\n\n  if (year >= startDate && year <= endDate && year >= 2001.) {\n    color.r = 220. / 255.;\n    color.g = (72. - zoom + 102. - 3. * intensity / zoom) / 255.;\n    color.b = (33. - zoom + 153. - intensity / zoom) / 255.;\n    return vec4(color, color.r);\n  } else {\n    return vec4(0., 0., 0., 0.);\n  }\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  if ((bitmapColor.r * 255.) < 1.) {\n    discard;\n  }\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n\n  float year = 2000.0 + (bitmapColor.b * 255.);\n  gl_FragColor = decodeFunction(bitmapColor.rgb, year);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){var t=[-1,-1,0,-1,1,0,1,1,0,1,-1,0];this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(t)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(t)}})}},{key:"updateState",value:function(t){var e=t.props,a=t.oldProps;t.changeFlags;if(e.fp64!==a.fp64){var n=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(n)}),this.getAttributeManager().invalidateAll()}e.image!==a.image&&this.loadTexture();var o=this.getAttributeManager();e.bitmapBounds!==a.bitmapBounds&&(this.setState({positions:this._getPositionsFromBounds(e.bitmapBounds)}),o.invalidate("positions"),o.invalidate("positions64xyLow"))}},{key:"_getPositionsFromBounds",value:function(t){var e=new Array(12);if(Number.isFinite(t[0]))e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[0],e[4]=t[3],e[5]=0,e[6]=t[2],e[7]=t[3],e[8]=0,e[9]=t[2],e[10]=t[1],e[11]=0;else for(var a=0;a<t.length;a++)e[3*a+0]=t[a][0],e[3*a+1]=t[a][1],e[3*a+2]=t[a][2]||0;return e}},{key:"_getModel",value:function(t){return t?new T.f(t,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new T.e({drawMode:b.a.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(t){var e=t.uniforms,a=this.state,n=a.bitmapTexture,o=a.model,i=this.props,r=i.desaturate,l=i.transparentColor,s=i.tintColor,c=i.startDate,u=i.endDate,d=i.zoom;n&&o&&o.render(Object.assign({},e,{bitmapTexture:n,desaturate:r,transparentColor:l,tintColor:s,startDate:c,endDate:u,zoom:d}))}},{key:"loadTexture",value:function(){var t,e=this,a=this.context.gl,n=this.props.image,o={parameters:(t={},Object(v.a)(t,b.a.TEXTURE_MIN_FILTER,b.a.NEAREST),Object(v.a)(t,b.a.TEXTURE_MAG_FILTER,b.a.NEAREST),Object(v.a)(t,b.a.TEXTURE_WRAP_S,b.a.CLAMP_TO_EDGE),Object(v.a)(t,b.a.TEXTURE_WRAP_T,b.a.CLAMP_TO_EDGE),t),mipmaps:!1};"string"===typeof n?Object(x.a)(n).then(function(t){e.setState({bitmapTexture:new T.g(a,Object(g.a)({data:t},o))})}):n instanceof T.g?this.setState({bitmapTexture:n}):(n instanceof Image||n instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new T.g(a,Object(g.a)({data:n},o))})}},{key:"calculatePositions",value:function(t){var e=t.value,a=this.state.positions;e.set(a)}},{key:"calculatePositions64xyLow",value:function(t){var e=this.use64bitPositions();(t.constant=!e,e)?t.value.set(this.state.positions.map(w)):t.value=new Float32Array(4)}}]),e}(_.c);C.layerName="BitmapLayer",C.defaultProps={image:null,bitmapBounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var k=function(){function t(e){var a=e.getTileData,n=e.x,o=e.y,i=e.z,r=e.onGetTileDataError;Object(l.a)(this,t),this.x=n,this.y=o,this.z=i,this.isVisible=!0,this.getTileData=a,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onGetTileDataError=r}return Object(s.a)(t,[{key:"_loadData",value:function(){var t=this,e=this.x,a=this.y,n=this.z;return this.getTileData?this.getTileData({x:e,y:a,z:n}).then(function(e){return t._data=e,t._isLoaded=!0,e}).catch(function(e){t._isLoaded=!0,t.onGetTileDataError(e)}):null}},{key:"isOverlapped",value:function(t){var e=this.x,a=this.y,n=this.z,o=Math.pow(2,t.z-n);return Math.floor(t.x/o)===e&&Math.floor(t.y/o)===a}},{key:"data",get:function(){return this._data?Promise.resolve(this._data):this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),t}(),D=a(16),z=a(26),L=512;function j(t){return Math.floor(t/L)}function O(t,e){var a=t.x,n=t.y,o=t.z,i=Math.pow(2,o-e);return{x:Math.floor(a/i),y:Math.floor(n/i),z:e}}var E=function(){function t(e){var a=e.getTileData,n=e.maxSize,o=e.maxZoom,i=e.minZoom,r=e.onGetTileDataError;Object(l.a)(this,t),this._getTileData=a,this._maxSize=n,this.onGetTileDataError=r,this._cache=new Map,o&&parseInt(o,10)===o&&(this._maxZoom=o),i&&parseInt(i,10)===i&&(this._minZoom=i)}return Object(s.a)(t,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(t,e){var a=this._cache,n=this._getTileData,o=this._maxSize,i=this._maxZoom,r=this._minZoom;this._markOldTiles();var l=function(t,e,a){var n=Math.floor(t.zoom);if(a&&n<a)return[];for(var o=function(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[e.reduce(function(t,e){return t<e[0]?t:e[0]},180),e.reduce(function(t,e){return t<e[1]?t:e[1]},90),e.reduce(function(t,e){return t>e[0]?t:e[0]},-180),e.reduce(function(t,e){return t>e[1]?t:e[1]},-90)]}(t=new t.constructor(Object(g.a)({},t,{zoom:n}))),i=Object(z.g)([o[0],o[3]],t.scale).map(j),r=Object(D.a)(i,2),l=r[0],s=r[1],c=Object(z.g)([o[2],o[1]],t.scale).map(j),u=Object(D.a)(c,2),d=u[0],h=u[1],p=[],m=l;m<=d;m++)for(var f=s;f<=h;f++)e&&n>e?p.push(O({x:m,y:f,z:n},e)):p.push({x:m,y:f,z:n});return p}(t,i,r);if(l&&0!==l.length){var s=new Set;a.forEach(function(t){l.some(function(e){return t.isOverlapped(e)})&&(t.isVisible=!0,s.add(t))});for(var c=0;c<l.length;c++){var u=l[c],d=u.x,h=u.y,p=u.z,m=this._getTile(d,h,p);m||(m=new k({getTileData:n,x:d,y:h,z:p,onGetTileDataError:this.onGetTileDataError}));var f=this._getTileId(d,h,p);a.set(f,m),s.add(m)}this._resizeCache(o||5*l.length),e(Array.from(s).sort(function(t,e){return t.z-e.z}))}else e(l)}},{key:"_resizeCache",value:function(t){var e=this._cache;if(e.size>t){var a=e[Symbol.iterator](),n=!0,o=!1,i=void 0;try{for(var r,l=a[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=r.value;if(e.size<=t)break;var c=s[0];s[1].isVisible||e.delete(c)}}catch(u){o=!0,i=u}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(t){t.isVisible=!1})}},{key:"_getTile",value:function(t,e,a){var n=this._getTileId(t,e,a);return this._cache.get(n)}},{key:"_getTileId",value:function(t,e,a){return"".concat(a,"-").concat(t,"-").concat(e)}}]),t}(),M={renderSubLayers:function(t){return new C(t)},getTileData:function(t){t.x,t.y,t.z;return Promise.resolve(null)},onDataLoaded:function(){},onGetTileDataError:function(t){return console.error(t)},maxZoom:null,minZoom:null,maxCacheSize:null},S=function(t){function e(){return Object(l.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(s.a)(e,[{key:"initializeState",value:function(){var t=this.props,e=t.maxZoom,a=t.minZoom,n=t.getTileData,o=t.onGetTileDataError;this.state={tiles:[],tileCache:new E({getTileData:n,maxZoom:e,minZoom:a,onGetTileDataError:o}),isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=this,a=t.props,n=(t.oldProps,t.context),o=t.changeFlags,i=a.onDataLoaded,r=a.onGetTileDataError;if(o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getTileData)){var l=a.getTileData,s=a.maxZoom,c=a.minZoom,u=a.maxCacheSize;this.state.tileCache.finalize(),this.setState({tileCache:new E({getTileData:l,maxSize:u,maxZoom:s,minZoom:c,onGetTileDataError:r})})}if(o.viewportChanged){var d=n.viewport,h=this.getLayerZoomLevel();"DEFAULT-INITIAL-VIEWPORT"!==d.id&&this.state.tileCache.update(d,function(t){var a=t.filter(function(t){return t.z===h}),n=a.every(function(t){return t.isLoaded});e.setState({tiles:t,isLoaded:n}),n?i(a.filter(function(t){return t._data}).map(function(t){return t._data})):Promise.all(a.map(function(t){return t.data})).then(function(){e.setState({isLoaded:!0}),i(a.filter(function(t){return t._data}).map(function(t){return t._data}))})})}}},{key:"getPickingInfo",value:function(t){var e=t.info,a=t.sourceLayer;return e.sourceLayer=a,e.tile=a.props.tile,e}},{key:"getLayerZoomLevel",value:function(){var t=Math.floor(this.context.viewport.zoom),e=this.props,a=e.maxZoom,n=e.minZoom;return a&&parseInt(a,10)===a&&t>a?a:n&&parseInt(n,10)===n&&t<n?n:t}},{key:"tile2long",value:function(t,e){return t/Math.pow(2,e)*360-180}},{key:"tile2lat",value:function(t,e){var a=Math.PI-2*Math.PI*t/Math.pow(2,e);return 180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)))}},{key:"renderLayers",value:function(){var t=this,e=this.props,a=(e.getTileData,e.renderSubLayers,e.visible),n=(Object(f.a)(e,["getTileData","renderSubLayers","visible"]),this.getLayerZoomLevel());return this.state.tiles.map(function(e){var o=e.x,i=e.y,r=e.z,l=[t.tile2long(o,r),t.tile2lat(i,r)],s=[t.tile2long(o+1,r),t.tile2lat(i,r)],c=[[t.tile2long(o,r),t.tile2lat(i+1,r)],l,s,[t.tile2long(o+1,r),t.tile2lat(i+1,r)]];return new C({id:"".concat(t.id,"-").concat(o,"-").concat(i,"-").concat(r),image:"https://storage.googleapis.com/wri-public/Hansen17/tiles/hansen_world/v1/tc30/".concat(r,"/").concat(o,"/").concat(i,".png"),bitmapBounds:c,desaturate:0,transparentColor:[0,0,0,0],visible:a&&(!t.state.isLoaded||r===n),tintColor:[255,255,255],zoom:n,endDate:t.props.endDate,fp64:!0})})}}]),e}(h.a);S.layerName="TileLayer",S.defaultProps=M;var A={longitude:-109.66698,latitude:60.74128,zoom:11},I=function(t){function e(){var t,a;Object(l.a)(this,e);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).state={endDate:2018},a._onWebGLInitialized=function(t){a.setState({gl:t})},a._onMapLoad=function(){var t=a._map,e=a._deck;t.addLayer(new m.a({id:"my-scatterplot",deck:e})),t.addLayer(new m.a({id:"bitmap-layer",deck:e,map:a._map}))},a}return Object(d.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var t=this,e=this.state.gl;var a=[new h.b({id:"my-scatterplot",data:[{position:[-74.5,40],size:100}],getPosition:function(t){return t.position},getRadius:function(t){return t.size},getFillColor:[255,0,0]}),new S({id:"my-tile-layer",stroked:!1,minZoom:3,maxZoom:12,getLineColor:[192,192,192],getFillColor:[140,170,180],getTileData:function(t){var e=t.x,a=t.y,n=t.z,o="https://storage.googleapis.com/wri-public/Hansen17/tiles/hansen_world/v1/tc30/".concat(n,"/").concat(e,"/").concat(a,".png");return fetch(o).then(function(t){return t.blob()}).then(function(t){var e=URL.createObjectURL(t),a=new Image;return a.src=e,a})},endDate:this.state.endDate})];return o.a.createElement(h.c,{ref:function(e){t._deck=e&&e.deck},layers:a,initialViewState:A,controller:!0,onWebGLInitialized:this._onWebGLInitialized},e&&o.a.createElement(p.a,{ref:function(e){t._map=e&&e.getMap()},gl:e,mapStyle:"mapbox://styles/mapbox/light-v9",mapboxApiAccessToken:"pk.eyJ1IjoiYWZpbGF0b3JlOTAiLCJhIjoiY2lqcml0bHoyMDBhZHZwbHhzM2Q1bnRwNSJ9.Zm2C1hNemolKnIAAWquGYg",onLoad:this._onMapLoad}))}}]),e}(o.a.Component),P=function(t){function e(){return Object(l.a)(this,e),Object(c.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return o.a.createElement(I,null)}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(P,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[103,1,2]]]);
//# sourceMappingURL=main.32b4cd11.chunk.js.map